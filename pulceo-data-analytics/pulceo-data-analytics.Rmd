---
title: "`r paste0('PULCEO Data Analytics:  ', params$subfolder)`" 
params:
  rootfolder: "."
  subfolder: "sample"
knit: (function(input_file, encoding) {
  metadata <- rmarkdown::yaml_front_matter(input_file);
  out_dir <- with(metadata, paste0("reports/", params$subfolder));
  rmarkdown::render(input_file,
  encoding=encoding,
  output_file=file.path(dirname(input_file), out_dir, "index.html"))})
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---
```{r warning=FALSE, echo=FALSE}
# install_and_load <- function(pkg, mirror = "https://cloud.r-project.org") {
#   # Set default CRAN mirror and silent options
#   options(repos = c(CRAN = mirror))
#   options(install.packages.check.source = "no")
#   options(ask = FALSE)

#   # Install if missing
#   if (!requireNamespace(pkg, quietly = TRUE)) {
#     message(sprintf("Installing '%s'...", pkg))
#     install.packages(pkg, dependencies = TRUE, quiet = TRUE)
#   }

#   # Load package quietly
#   suppressPackageStartupMessages(
#     library(pkg, character.only = TRUE, quietly = TRUE, warn.conflicts = FALSE)
#   )
# }
# install_and_load("tidyverse")
# install_and_load("stringi")
# install_and_load("rjson")
# install_and_load("kableExtra")
# install_and_load("gridExtra")
#install_and_load("ggpubr")
# install_and_load("data.table")
# install_and_load("jsonlite")
install_and_load("here")

# TODO: globally load library(here)
```

```{r, include=FALSE}
# set this option in the first code chunk in the document
# TODO: maybe remove
knitr::opts_knit$set(root.dir = here())
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, include = FALSE)
```

```{r include=TRUE, echo=FALSE}
# TODO: remove
ROOTFOLDER <- "/tmp/psm-data"
```

```{r directories, include=FALSE, echo=FALSE}
source(here("includes/R/directories.R"))
source(here("includes/R/tables.R"))
```

```{r child = 'includes/topology.Rmd'}
```

```{r child = 'includes/resources.Rmd'}
```

```{r child = 'includes/events.Rmd'}
```

```{r child = 'includes/metrics.Rmd'}
```

```{r child = 'includes/metrics/cpu-util.Rmd'}
```

```{r child = 'includes/metrics/mem-util.Rmd'}
```

```{r child = 'includes/metrics/storage-util.Rmd'}
```

```{r child = 'includes/metrics/net-util.Rmd'}
```

```{r child = 'includes/metrics/combined-util.Rmd'}
```

## Link Quality Metrics

```{r child = 'includes/metrics/rtt.Rmd'}
```

```{r child = 'includes/metrics/bw.Rmd'}
```

```{r child = 'includes/metrics/combined-link-quality.Rmd'}
```

```{r child = 'includes/metrics/requests.Rmd'}
```
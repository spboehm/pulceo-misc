# Links

## Required Libraries

```{r warning=FALSE}
if(!require(kableExtra)) {
    install.packages("kableExtra")
    library(kableExtra)
}
if(!require(tidyverse)) {
    install.packages("tidyverse")
    library(tidyverse)
}
```

## Functions

Important symbols:

- `x`: Means "between all nodes", network-related metrics are obtained between all nodes of the particular layers.
- `o`: Means "between particular pairs of nodes", network-related metrics are obtained between particular pairs of nodes.
- `|`: Means "between particular layers", network-related metrics are obtained between particular layers.
- `S`: Means "static", network-related metrics are used, required, or obtained in a static. They do not change over time.
- `D`: Means "dynamic", network-related metrics are used, required, or obtained in a dynamic way. Dynamic changes over time are considered.
- `H`: Means "hops", the number of hops are used, required, or obtained. It is the number of hops a packet requires to travel from one endpoint to another endpoint.
- `L`: Means "latency", it is either used, required, or obtained. It refers to the general network latency or network delay in IP networks, thus, the time for a packet to travel from one endpoint to another. We differentiate between the Round-trip time (RTT) and the End-to-end (E2E) latency.
- `R`: Means "RTT". To be used as more specific value for latency.
- `E`: Means "E2E" latency. To be used as more specific value for latency.
- `B`: Means "bandwidth", it is either used, required, or obtained. It refers to the data transfer rate (i.e., capacity) of a network.

Notations:

- `x (SDH(L|R|E)B)`: If some of the criteria a supported.
  - Make sure that at 5 characters are within the brackets, for example (S-H-B).
  - Whitespaces are removed automatically.
  - Only `S,D,H,L,R,E,B` are supported.
- `n`: If nothing is used, supported, or obtained.

```{r}
ReplaceSymbol <- function(symbol) {
  switch(symbol,
         "x" = "\\ding{108}",
         "o" = "\\ding{110}",
         "|" = "\\ding{115}",
         "n" = "\\ding{55}",
         "-" = "-",
         "S" = "S",
         "D" = "D",
         "H" = "H",
         "L" = "L",
         "R" = "R",
         "E" = "E",
         "B" = "B"
         )
}

ReplaceSymbolsInCols <- function(col) {
  
  df <- lapply(col, function(chars) {
  
    if (chars == "n") {
      return (ReplaceSymbol("n"))
    }
    
    # add default if no subscripts are available
    if (nchar(chars) == 1) {
      chars <- paste(chars, "-----", sep = "")
    }
    
    # remove brackets
    charsWithoutBrackets <- gsub('\\(|\\)', '', chars)
    
    # remove whitespaces
    charsWithoutWhitespaces <- gsub('\\s', '', charsWithoutBrackets)
    charsAsVector <- as.vector(unlist(strsplit(charsWithoutWhitespaces,"")))
    
    # template symbol
    charsAsVector <- sapply(charsAsVector, ReplaceSymbol)

    # template textsuperscript, we do not need to escape ',' because of latex math mode
    templateTextSuperScript <- "^{2,3}"
    templateMutatedStatic <- gsub('2', charsAsVector[2], templateTextSuperScript)
    templateMutatedDynamic <- gsub('3', charsAsVector[3], templateMutatedStatic)
    
    # template textsubscript
    templateTextSubscript <- "_{4,5,6}"
    templateMutatedHops <-  gsub('4', charsAsVector[4], templateTextSubscript)
    templateMutatedLatency <-  gsub('5', charsAsVector[5], templateMutatedHops)
    templateMutatedBandwidth <- gsub('6', charsAsVector[6], templateMutatedLatency)
    
    return(paste(charsAsVector[1], "$", templateMutatedDynamic, templateMutatedBandwidth, "$", sep=""))
  
  })
  return (df)
}

ReplaceScriptsInCols <- function(df)  {
  return (df %>% mutate_at(., vars(-Author,-Year), ReplaceSymbolsInCols))
}
```

## Read CSVs

The data columns are following this pattern: `<Relation>_<Metric>`,  for example `CC_RTD`, which describes that the cloud layer uses, requires, or obtains the Round-trip delay (RTD).

Characteristics are possible:

- `y`: Means "yes", network-related metrics are obtained.
- `n`: Means "no", network-related metrics are not obtained.

Relations:

- `CC`: Between cloud nodes
- `CF`: Between cloud and fog nodes
- `CE`: Between cloud and edge nodes
- `CU`: Between cloud and end users
- `FF`: Between fog nodes
- `FE`: Between fog and edge nodes
- `FU`: Between fog and end users
- `EE`: Between edge nodes
- `EU`: Between edge nodes and end users
- `UU`: Between end users

All relations can indicate both directions equivalently, for example, `CF` means cloud-to-fog and fog-to-cloud interactions. 

### Delay Properties

Metrics:

- `RTD`: Round-trip delay
- `E2E`: End-to-end delay

Additional columns:

- `RTD_MEASURING`: Indicated how the RTD is obtained.
  - `s`: Means "static", RTD is used, required, or obtained in a static. They do not change over time.
  - `d`: Means "dynamic", RTD is used, required, or obtained in a dynamic way. Dynamic changes over time are considered.
  - `n`: Means "no" usage of RTD.
- `E2E_MEASURING`: Either `s` for "static" or `d` for "dynamic".
  - `s`: Means "static", E2E is used, required, or obtained in a static. They do not change over time.
  - `d`: Means "dynamic", E2E is used, required, or obtained in a dynamic way. Dynamic changes over time are considered.
  - `n`: Means "no" usage of RTD.

```{r}
# delay properties, split into two different files
rtdProps <- read.csv2("csv/links-round-trip-delay-properties.csv")
e2eProps <- read.csv2("csv/links-end-to-end-delay-properties.csv")

# TODO: validate
```

```{r}
# bandwidth properties


# hop properties
```

## Replace Symbols in Columns

```{r}
lPropsMutated <- ReplaceScriptsInCols(lProps)
```

## Create LaTeX Table

### Latency

### Bandwidth

### Number of Hops

### Link Properties

```{r}
kbl_fn_footnote_as_chunk = TRUE
kbl_fn_threeparttable = TRUE
kbl_fn_general_title = ""

lPropsKblCaption <- "Link Properties"

lPropsKbl <- kbl(lPropsMutated, "latex", escape = FALSE, caption = lPropsKblCaption, booktabs = TRUE) %>% 
  kable_styling(latex_options = "scale_down") %>%
  footnote(., general = c(""), general_title = kbl_fn_general_title, footnote_as_chunk = kbl_fn_footnote_as_chunk, threeparttable = kbl_fn_threeparttable)

save_kable(lPropsKbl, "latex/link-properties.tex")
```
